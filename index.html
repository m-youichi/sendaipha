<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>一般社団法人川内薬剤師会</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="header-container">
      <img src="img/SPA.png" alt="一般社団法人川内薬剤師会ロゴ" class="header-logo-large">
      <div class="header-title-group-row">
        <h1 class="main-title"><a href="index.html" style="color:inherit;text-decoration:none;">一般社団法人川内薬剤師会</a></h1>
        <div class="sub-title">Sendai Pharmaceutical Association</div>
      </div>
    </div>
    <nav class="global-nav">
      <ul>
        <li><a href="index.html">HOME</a></li>
        <li class="has-submenu">
          <a href="about.html">組織概要</a>
          <ul class="submenu">
            <li><a href="greeting.html">会長あいさつ</a></li>
            <li><a href="officers.html">役員一覧</a></li>
            <li><a href="rules.html">定款</a></li>
          </ul>
        </li>
        <li><a href="search.html">薬局検索</a></li>
        <li><a href="fax.html">FAXコーナー</a></li>
        <li><a href="contact.html">事務局</a></li>
      </ul>
    </nav>
  </header>
  
  <button id="sidebar-toggle">
    <div class="arrow-toggle">▶</div>
  </button>
  
  <div class="container">
    <div class="sidebar-wrapper">
      <nav class="sidebar">
        <ul>
          <li style="visibility:hidden;">ダミー</li>
            <li><a href="holiday.html">休日当番</a></li>
            <li><a href="night.html">夜間輪番</a></li>
            <li><a href="homecare.html">在宅可能薬局リスト</a></li>
            <li><a href="frail.html">フレイル予防講座</a></li>
            <li><a href="search.html">薬局検索</a></li>
            <li><a href="school.html">学校薬剤師</a></li>
            <li><a href="disaster.html">災害対策</a></li>
            <li><a href="collab.html">薬薬連携</a></li>
            <li><a href="workshop.html">研修会</a></li>
            <li><a href="kagonet.html">カゴネット</a></li>
            <li><a href="koshiki.html">甑島医療調査</a></li>
          </ul>
      </nav>
    </div>
    <div class="sidebar-overlay"></div>
    <div class="main-content">
      <main>
        <section id="news">
          <div class="container">
            <h2>お知らせ</h2>
            <p style="margin-bottom: 2rem; color: #666; line-height: 1.6;">
              川内薬剤師会からの最新のお知らせ・ご案内をご覧いただけます。
            </p>
            
            <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div id="news-list-full" class="news-list-full">
                <!-- GASで自動更新される部分 -->
                <div class="news-item">
                  <div class="news-date">2024.01.15</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample1" target="_blank">令和6年度 薬剤師研修会のご案内</a></h3>
                    <p>令和6年度の薬剤師研修会を開催いたします。詳細は添付資料をご確認ください。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2024.01.10</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample2" target="_blank">年末年始の休日当番薬局について</a></h3>
                    <p>年末年始期間中の休日当番薬局の一覧をお知らせいたします。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2024.01.08</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample3" target="_blank">インフルエンザ予防接種実施薬局一覧</a></h3>
                    <p>インフルエンザ予防接種を実施している薬局の一覧を更新いたしました。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2024.01.05</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample4" target="_blank">薬局における在宅医療推進事業について</a></h3>
                    <p>在宅医療推進事業に関する新しいガイドラインをお知らせいたします。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2024.01.03</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample5" target="_blank">新型コロナウイルス感染症対策ガイドライン更新</a></h3>
                    <p>新型コロナウイルス感染症対策ガイドラインを最新版に更新いたしました。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2023.12.28</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample6" target="_blank">年末年始休業のお知らせ</a></h3>
                    <p>年末年始の休業期間についてお知らせいたします。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2023.12.20</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample7" target="_blank">薬剤師会忘年会開催のご案内</a></h3>
                    <p>令和5年度薬剤師会忘年会を開催いたします。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2023.12.15</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample8" target="_blank">冬季感染症対策について</a></h3>
                    <p>冬季に流行する感染症の対策についてお知らせいたします。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2023.12.10</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample9" target="_blank">薬局における健康サポート機能強化について</a></h3>
                    <p>薬局の健康サポート機能強化に関する取り組みについてご案内いたします。</p>
                  </div>
                </div>
                
                <div class="news-item">
                  <div class="news-date">2023.12.05</div>
                  <div class="news-content">
                    <h3><a href="#" data-file-id="sample10" target="_blank">令和5年度第3回研修会開催報告</a></h3>
                    <p>令和5年度第3回研修会を開催いたしました。ご参加ありがとうございました。</p>
                  </div>
                </div>
              </div>
              
              <div class="news-more-section" style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #eee;">
                <a href="new.html" class="news-more-btn" style="display: inline-block; background: #2c3e50; color: #fff; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: background 0.3s;">
                  過去の記事はこちら
                </a>
              </div>
              
              <div id="loading" style="text-align: center; padding: 2rem; display: none;">
                <p>お知らせを読み込み中...</p>
              </div>
              
              <div id="no-news" style="text-align: center; padding: 2rem; display: none;">
                <p>現在、お知らせはありません。</p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
  
  <div id="footer-include">
    <footer>
      <div class="footer-global-nav">
        <div class="footer-cards">
          <a class="footer-card" href="https://kayaku.jp/" target="_blank">鹿児島県薬剤師会</a>
          <a class="footer-card" href="https://www.nichiyaku.or.jp/" target="_blank">日本薬剤師会</a>
        </div>
        <div class="footer-office-info">
          <p>〒895-0027<br>薩摩川内市西向田町17-11<br>TEL：0996(41)5019　FAX：0996(22)4449</p>
        </div>
      </div>
      <div class="copyright">&copy; 一般社団法人川内薬剤師会</div>
    </footer>
  </div>
  
  <script>
    // グローバルナビのサブメニュー制御
    document.addEventListener('DOMContentLoaded', function() {
      const hasSubmenuItems = document.querySelectorAll('.has-submenu');
      hasSubmenuItems.forEach(item => {
        const link = item.querySelector('a');
        const submenu = item.querySelector('.submenu');
        
        item.addEventListener('mouseenter', function() {
          item.classList.add('submenu-open');
        });
        
        item.addEventListener('mouseleave', function() {
          item.classList.remove('submenu-open');
        });
      });
    });
    
    // サイドバー制御
    console.log("sidebar.js loaded");
    
    function waitForSidebarAndInit() {
      const btn = document.getElementById('sidebar-toggle');
      const arrow = btn.querySelector('.arrow-toggle');
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      if (btn && sidebar && overlay) {
        // 現在ページにactiveクラスを付与
        const links = document.querySelectorAll('.sidebar a');
        const path = location.pathname.split('/').pop().replace(/\?.*$/, '');
        links.forEach(link => {
          if (link.getAttribute('href').replace(/\.html$/, '') === path.replace(/\.html$/, '')) {
            link.classList.add('active');
          }
        });
        
        btn.addEventListener('click', function() {
          sidebar.classList.toggle('open');
          overlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
          arrow.textContent = sidebar.classList.contains('open') ? '◀' : '▶';
          arrow.classList.toggle('active', sidebar.classList.contains('open'));
        });
        
        overlay.addEventListener('click', function() {
          sidebar.classList.remove('open');
          overlay.style.display = 'none';
          arrow.textContent = '▶';
          arrow.classList.remove('active');
        });
      } else {
        setTimeout(waitForSidebarAndInit, 50);
      }
    }
    waitForSidebarAndInit();
    
    // お知らせ一覧の自動更新
    async function loadAllNewsFromGAS() {
      const loading = document.getElementById('loading');
      const noNews = document.getElementById('no-news');
      const newsList = document.getElementById('news-list-full');
      
      try {
        loading.style.display = 'block';
        
        // GASのWebアプリURLを設定（後で実際のURLに変更）
        const GAS_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
        
        const response = await fetch(GAS_URL);
        const newsData = await response.json();
        
        loading.style.display = 'none';
        
        if (newsData && newsData.length > 0) {
          updateAllNewsList(newsData);
        } else {
          noNews.style.display = 'block';
          newsList.style.display = 'none';
        }
      } catch (error) {
        console.log('お知らせの自動更新に失敗しました:', error);
        loading.style.display = 'none';
        // エラー時はデフォルトのお知らせを表示
      }
    }
    
    function updateAllNewsList(newsData) {
      const newsList = document.getElementById('news-list-full');
      if (!newsList) return;
      
      // 最新10件のお知らせを表示
      const latestNews = newsData.slice(0, 10);
      
      newsList.innerHTML = latestNews.map(news => `
        <div class="news-item">
          <div class="news-date">${news.date}</div>
          <div class="news-content">
            <h3><a href="${news.url}" data-file-id="${news.fileId}" target="_blank">${news.title}</a></h3>
            <p>ファイルサイズ: ${formatFileSize(news.size)} | 形式: ${getFileTypeLabel(news.mimeType)}</p>
          </div>
        </div>
      `).join('');
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function getFileTypeLabel(mimeType) {
      const types = {
        'application/pdf': 'PDF',
        'application/msword': 'Word',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'Word',
        'text/plain': 'テキスト'
      };
      return types[mimeType] || 'ファイル';
    }
    
    // ページ読み込み時にお知らせを更新
    document.addEventListener('DOMContentLoaded', function() {
      // 開発中はコメントアウト
      // loadAllNewsFromGAS();
    });
  </script>
</body>
</html>

